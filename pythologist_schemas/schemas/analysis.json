{
    "$schema": "https://json-schema.org/schema#",
    "type": "object",
    "description":"A generic way of storing an image and its analyzed components",
    "definitions":{
        "ImageData":{
            "type":"object",
            "properties":{
                "id":{
                    "type":"string",
                    "description":"A UUID4 to identify the image data in an object"
                },
                "Meta":{
                    "type":"object",
                    "properties":{
                        "Label":{"type":"string"},
                        "Description":{"type":"string"},                        
                        "ImageSize":{
                            "type":"object",
                            "properties":{
                                "x":{"type":"int"},
                                "y":{"type":"int"}
                            },
                            "required":["x","y"]
                        }
                    }
                }
            },
            "required":["ID"]
        },
        "BinaryMaskImage":{
            "allOf":[
                {"$ref":"#/definitions/ImageData"},
                {
                    "properties":{
                        "Type":{
                            "type":"string",
                            "enum":["ProcessedImage","MutuallyExclusiveRegion","Other"]
                        },
                        "MaskedAreaPixels":{"type":"int"}
                    },
                    "required":["Type","MaskedAreaPixels"]
                 }
            ]
        },
        "IndexedSegmentationImage":{
            "allOf":[
                {"$ref":"#/definitions/ImageData"},
                {
                    "properties":{
                        "Type":{
                            "type":"string",
                            "enum":["Nuclear","Membrane","Other"]
                        }
                    },
                    "required":["Type"]
                }
            ]            
        },
        "ComponentImage":{
            "allOf":[
                {"$ref":"#/definitions/ImageData"},
                {
                    "properties":{
                        "MarkerName":{
                            "type":"string"
                        }
                    },
                    "required":["MarkerName"]
                }
            ]            
        },
        "CellData":{
            "type":"object",
            "properties":{
                "Index":{
                    "type":"int",
                    "description":"Integer index that ties a cell to a mask in an IndexedSegmentationImage."
                },
                "CartesianCoordiantes":{
                    "type":"object",
                    "properties":{
                        "x":{"type":"int"},
                        "y":{"type":"int"}
                    },
                    "required":["x","y"]
                },
                "MutuallyExclusiveRegion":{"type":"string"},
                "MutuallyExclusivePhenotype":{"type":"string"},
                "Thresholds":{
                    "type":"array",
                    "items":{
                        "type":"object",
                        "properties":{
                            "MarkerName":{"type":"string"},
                            "FilterStatus":{
                                "type":"string",
                                "enum":["+","-"]
                            }
                        },
                        "required":["MarkerName","FilterStatus"]
                    }
                },
                "Channels":{
                    "type":"array",
                    "items":{
                        "type":"object",
                        "MarkerName":{"type":"string"},
                        "ThresholdFilterStatus":{
                            "type":["string"],
                            "enum":["+","-","null"]
                        },
                        "MeanIntensities":{
                            "type":"array",
                            "items":{
                                "type":"object",
                                "properties":{
                                    "Compartment":{"type":"string"},
                                    "MeanIntensity":{"type":"float"}
                                },
                                "required":["Compartment","MeanIntensity"]
                            }
                        }
                    }
                },
                "Contacts":{
                    "type":"array",
                    "items":{"type":"int"},
                    "description":"If calculated/included, this is an array of Indicies of other cells in direct contact with this cell."
                }
            }
        },
        "AnalyzedImage":{
            "type":"object",
            "properties": {
                "ImageName":{"type":"string"},
                "ImageSize":{
                    "type":"object",
                    "properties":{
                        "x":{"type":"int"},
                        "y":{"type":"int"}
                    },
                    "required":["x","y"]
                },
                "ProcessedImageMask":{
                    "type":{"$ref":"#/definitions/BinaryMaskImage"}            
                },
                "MutuallyExclusiveRegionMasks":{
                     "type":"array",
                     "items":{
                         "allOf":[
                             {"$ref":"#/definitions/BinaryMaskImage"},
                             {
                                 "properties":{
                                    "MutuallyExclusiveRegionName":{"type":"string"},
                                 },
                                 "required":["MutuallyExclusiveRegionName"]
                              }
                         ]
                     }
                },
                "Segmentations":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/IndexedSegmentationImage"}            
                },
                "Components":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/ComponentImage"}            
                },
                "Annotations":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/MaskImage"}            
                },
                "CellDataFrame":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/ComponentImage"}            
                }
            },
            "required":["ImageName","ImageSize","ProcessedImageMask","RegionMasks","Segmentations","Components","CellDataFrame"]
        },
        "AnalyzedSample":{
            "type":"object",
            "description":"A collection of Images that make up one sample.",
            "properties":{
                "SampleName":{"type":"string"},
                "AnalyzedImages":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/AnalyzedImage"}
                }
            }
        }
    },
    "properties":{
        "type":"object",
        "description":"A project that has been analyzed and is staged for data extraction and interrogation.",
        "properties":{
            "ProjectName":{"type":"string"},
            "AnalyzedSamples":{
                "type":"array",
                "items":{"$ref":"#/definitions/AnalyzedSample"}
            }
        }
    }
}
