{
    "$schema": "https://json-schema.org/schema#",
    "type": "object",
    "description":"Define the output report single sample in InForm.",
    "definitions":{
        "image_attributes":{                            
            "type":"object",
            "properties":{
                "image_name":{
                    "type":"string"
                },
                "image_size_pixels":{
                    "type":"object",
                    "properties":{
                        "y":{
                            "type":"integer"
                        },
                        "x":{
                            "type":"integer"
                        }
                    },
                    "additionalProperties":false,
                    "required":["y","x"]
                },
                "microns_per_pixel":{
                    "type":"number"
                },
                "region_sizes":{
                    "type":"array",
                    "items":{
                        "type":"object",
                        "properties":{
                            "region_name":{
                                "type":"string"
                            },
                            "region_area_pixels":{
                                "type":"integer"
                            }
                        },
                        "additionalProperties":false,
                        "required":["region_name","region_area_pixels"]
                    }
                },
                "phenotype_map":{
                    "type":"object",
                    "properties":{
                        "column_names":{
                            "description":"the column header describing the rows of the phenotype map.",
                            "type":"array",
                            "items":{
                                "type":"string"
                            },
                            "const":["cell_index","x","y","region_name","mutually_exclusive_phenotype","binary_phenotypes"]
                        },
                        "rows":{
                            "type":"array",
                            "items":{
                                "anyOf":[
                                    {
                                        "description":"cell_index, x, y columns",
                                        "type":"integer"
                                    },
                                    {
                                        "description":"region name and mutually exclusive phenotype name",
                                        "type":"string"
                                    },
                                    {
                                        "title":"binary_phenotype",
                                        "type":"array",
                                        "description":"A list of key value pairs with marker and whether its positive or negative",
                                        "items":{
                                            "array":{
                                                "items":{
                                                    "anyOf":[
                                                        {
                                                            "type":"string",
                                                            "title":"key"
                                                        },
                                                        {
                                                            "type":"integer",
                                                            "title":"value",
                                                            "enum":[0,1]
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        "mutually_exclusive_phenotypes":{
                            "type":"array",
                            "items":{
                                "type":"string"
                            }
                        }
                    },
                    "additionalProperties":false,
                    "required":["column_names","rows","mutually_exclusive_phenotypes"]
                }
            },
            "required":["image_name","image_size_pixels","region_sizes","phenotype_map"]    
        },
        "sample_cumulative_density_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "cumulative_region_area_pixels":{
                    "type":"integer"
                },
                "cumulative_region_area_mm2":{
                    "type":"number"
                },
                "cumulative_count":{
                    "type":"integer"
                },
                "cumulative_density_mm2":{
                    "type":["number","null"]
                },
                "image_count":{
                    "type":"number"
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name",
                        "cumulative_region_area_pixels","cumulative_region_area_mm2","cumulative_count","cumulative_density_mm2",
                        "image_count","measure_qc_pass"
                       ]
        },
        "sample_aggregate_density_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "aggregate_mean_density_mm2":{
                    "type":["number","null"]
                },
                "aggregate_stddev_density_mm2":{
                    "type":["number","null"]
                },
                "aggregate_stderr_density_mm2":{
                    "type":["number","null"]
                },
                "image_count":{
                    "type":"number"
                },
                "aggregate_measured_image_count":{
                    "type":"number"
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name",
                        "aggregate_mean_density_mm2","aggregate_stddev_density_mm2","aggregate_stderr_density_mm2",
                        "image_count","aggregate_measured_image_count","measure_qc_pass"
                       ]
        },
        "image_density_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "region_area_pixels":{
                    "type":"integer"
                },
                "region_area_mm2":{
                    "type":"number"
                },
                "count":{
                    "type":"integer"
                },
                "density_mm2":{
                    "type":["number","null"]
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name","region_area_pixels","region_area_mm2","count","density_mm2","measure_qc_pass"]
        },
        "sample_cumulative_percentage_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "cumulative_numerator_count":{
                    "type":"integer"
                },
                "cumulative_denominator_count":{
                    "type":"integer"
                },
                "cumulative_fraction":{
                    "type":["number","null"]
                },
                "cumulative_percent":{
                    "type":["number","null"]
                },
                "image_count":{
                    "type":"integer"
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name",
                        "cumulative_numerator_count","cumulative_denominator_count","cumulative_fraction","cumulative_percent",
                        "image_count","measure_qc_pass"
                       ]
        },
        "sample_aggregate_percentage_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "aggregate_mean_fraction":{
                    "type":["number","null"]
                },
                "aggregate_stddev_fraction":{
                    "type":["number","null"]
                },
                "aggregate_stderr_fraction":{
                    "type":["number","null"]
                },
                "aggregate_mean_percent":{
                    "type":["number","null"]
                },
                "aggregate_stddev_percent":{
                    "type":["number","null"]
                },
                "aggregate_stderr_percent":{
                    "type":["number","null"]
                },
                "image_count":{
                    "type":"integer"
                },
                "aggregate_measured_image_count":{
                    "type":"integer"
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name",
                        "aggregate_mean_fraction","aggregate_stddev_fraction","aggregate_stderr_fraction",
                        "aggregate_mean_percent","aggregate_stddev_percent","aggregate_stderr_percent",
                        "image_count","aggregate_measured_image_count","measure_qc_pass"
                       ]
        },
        "image_percentage_row":{
            "type":"object",
            "properties":{
                "region_name":{
                    "type":"string"
                },
                "population_name":{
                    "type":"string"
                },
                "numerator_count":{
                    "type":"integer"
                },
                "denominator_count":{
                    "type":"integer"
                },
                "fraction":{
                    "type":["number","null"]
                },
                "percent":{
                    "type":["number","null"]
                },
                "measure_qc_pass":{
                    "type":"boolean"
                }
            },
            "additionalProperties":false,
            "required":["region_name","population_name","numerator_count","denominator_count","fraction","percent","measure_qc_pass"]
        }
    },
    "properties":{
        "run_id":{
            "type":"string"
        },
        "time":{
            "type":"string"
        },
        "project_name":{
            "type":"string"
        },
        "report_name":{
            "type":"string"
        },
        "report_version":{
            "type":"string"
        },
        "analysis_name":{
            "type":"string"
        },
        "analysis_version":{
            "type":"string"
        },
        "panel_name":{
            "type":"string"
        },
        "panel_version":{
            "type":"string"
        },
        "sample_outputs":{
            "type":"array",
            "items":{
                "type":"object",
                "properties":{
                    "sample_name":{
                        "type":"string"
                    },
                    "sample_reports":{
                        "type":"object",
                        "properties":{
                            "sample_cumulative_count_densities":{
                                "description":"Report for aggrogated measurements within a sample for density.",
                                "type":"array",
                                "items":{"$ref":"#/definitions/sample_cumulative_density_row"}
                            },
                            "sample_aggregate_count_densities":{
                                "description":"Report for aggrogated measurements within a sample for density.",
                                "type":"array",
                                "items":{"$ref":"#/definitions/sample_aggregate_density_row"}
                            },
                            "sample_cumulative_count_percentages":{
                                "description":"Report for aggrogated measurements within a sample for percentages.",
                                "type":"array",
                                "items":{"$ref":"#/definitions/sample_cumulative_percentage_row"}
                            },
                            "sample_aggregate_count_percentages":{
                                "description":"Report for aggrogated measurements within a sample for percentages.",
                                "type":"array",
                                "items":{"$ref":"#/definitions/sample_aggregate_percentage_row"}
                            }
                        },
                        "additionalProperties":false,
                        "required":["sample_cumulative_count_densities","sample_aggregate_count_densities",
                                    "sample_cumulative_count_percentages","sample_aggregate_count_percentages"]
                    },
                    "images":{
                        "type":"array",
                        "items":{
                                "allOf":[
                                    {"$ref":"#/definitions/image_attributes"},
                                    {
                                        "image_reports":{
                                            "type":"object",
                                            "properties":{
                                                "image_count_densities":{
                                                    "description":"Report for density in a given image.",
                                                    "type":"array",
                                                    "items":{"$ref":"#/definitions/image_density_row"}
                                                },
                                                "image_count_percentages":{
                                                    "description":"Report for measurements within a frame for percentages.",
                                                    "type":"array",
                                                    "items":{"$ref":"#/definitions/image_percentage_row"}
                                                }
                                            },
                                            "additionalProperties":false,
                                            "required":["image_count_densities","image_count_percentages"]
                                        }
                                    }
                                ]
                            },
                            "required":["image_name","image_reports","image_size_pixels","microns_per_pixel","region_sizes","phenotype_map"]
                        
                    },
                    "intermediate_files":{
                        "type":"object",
                        "properties": {
                            "project_h5":{"type":["string","null"]},
                            "celldataframe_h5":{"type":["string","null"]}
                        },
                        "additionalProperties":false,
                        "required":["project_h5","celldataframe_h5"]
                    }
                },
                "additionalProperties":false,
                "required":["sample_name","sample_reports","images","intermediate_files"]
            }
        }
    },
    "additionalProperties":false,
    "required":["run_id","time",
                "project_name","report_name","report_version","analysis_name","analysis_version","panel_name","panel_version",
                "sample_outputs"]
}
