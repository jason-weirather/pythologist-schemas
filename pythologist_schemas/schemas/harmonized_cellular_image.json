{
    "$schema": "https://json-schema.org/schema#",
    "type": "object",
    "description":"A generic way of storing an image and its analyzed components",
    "definitions":{
        "cartesian_coordinates":{
            "type":"object",
            "properties":{
                "x":{"type":"integer"},
                "y":{"type":"integer"}
            },
            "required":["x","y"],
            "additionalProperties":false
        },
        "index_coding":{
            "type":"array",
            "items":{
                "type":"object",
                "properties":{
                    "index":{"type":"integer"},
                    "label":{"type":"string"}
                },
                "required":["index","label"],
                "additionalProperties":false
            }
        },
        "image_data":{
            "type":"object",
            "properties":{
                "image_id":{
                    "type":"string",
                    "description":"A UUID4 to identify the image data in an object"
                },
                "image_attributes":{
                    "type":"object",
                    "properties":{
                        "label":{"type":"string"},
                        "image_size":{"$ref":"#/definitions/cartesian_coordinates"}
                    },
                    "additionalProperties":false
                },
                "meta":{
                    "type":"object",
                    "properties":{
                        "description":{"type":"string"}
                    }
                }
            },
            "required":["ID"],
            "additionalProperties":false
        },
        "binary_mask_image":{
            "allOf":[
                {"$ref":"#/definitions/image_data"},
                {
                    "properties":{
                        "mask_attributes":{
                            "type":"object",
                            "properties":{
                                "mask_label":{"type":"string"},
                                "type":{
                                    "type":"string",
                                    "enum":["ProcessedImage","FeatureAnnotation","Other"]
                                },
                                "area":{
                                    "type":"integer",
                                    "description":"Area in pixels."
                                },
                                "label":{
                                    "type":"string",
                                    "description":"The label of the masked element."
                                }
                            },
                            "additionalProperties":false,
                            "required":["type","area","label"]
                        }
                    },
                    "additionalProperties":false,
                    "required":["mask_attributes"]
                 }
            ]
        },
        "indexed_mask_image":{
            "allOf":[
                {"$ref":"#/definitions/image_data"},
                {
                    "properties":{
                        "indexed_mask_attributes":{
                            "type":"object",
                            "properties":{
                                "mask_label":{"type":"string"},
                                "type":{
                                    "type":"string",
                                    "enum":["Annotations","MutuallyExclusiveRegions","Other"]
                                },
                                "index_labels":{
                                    "type":"array",
                                    "items":{
                                        "type":"object",
                                        "properties":{
                                            "index":{"type":"integer"},
                                            "label":{"type":"string"},
                                            "area":{
                                                "type":"string",
                                                "description":"Area in pixels"
                                            }
                                        },
                                        "required":["index","label","area"],
                                        "additionalProperties":false
                                    }
                                }
                            },
                            "additionalProperties":false,
                            "required":["type","labels"]
                        }
                    },
                    "additionalProperties":false,
                    "required":["indexed_mask_attributes"]
                 }
            ]
        },
        "indexed_segmentation_image":{
            "allOf":[
                {"$ref":"#/definitions/image_data"},
                {
                    "properties":{
                        "segmentation_image_attributes":{
                            "type":"object",
                            "segmentation_label":{"type":"string"},
                            "properties":{
                                "is_primary":{"type":"boolean"},
                                "type":{
                                    "type":"string",
                                    "enum":["Nuclear","Membrane","Other"]
                                }
                            },
                            "additionalProperties":false,
                            "required":["type","segmentation_label","is_primary"]
                        }
                    },
                    "required":["segmentation_image_attributes"],
                    "additionalProperties":false
                }
            ],
            "description":"A one-based integer coded representation of the segmentation that is ordered identically to the cell_data."            
        },
        "component_image":{
            "allOf":[
                {"$ref":"#/definitions/image_data"},
                {
                    "properties":{
                        "component_image_attributes":{
                            "type":"object",
                            "properties":{
                                "marker_name":{
                                    "type":"string"
                                }
                            },
                            "required":["marker_name"],
                            "additionalProperties":false
                        }
                    },
                    "required":["component_image_attributes"],
                    "additionalProperties":false
                }
            ]            
        },
        "cell_attributes":{
            "type":"object",
            "description":"Text-data for a single cell.",
            "properties":{
                "index":{
                    "type":"integer",
                    "description":"Index that ties a cell to a mask in an indexed_segmentation_image."
                },
                "cartesian_coordiantes":{"$ref":"#/definitions/cartesian_coordinates"},
                "area":{"type":"integer"},
                "edge_length":{"type":"integer"},
                "mutually_exclusive_regions":{
                    "type":"array",
                    "description":"For a list of defined mutually exclusive region masks, specify what the label is for each.",
                    "items":{
                        "type":"object",
                        "properties":{
                            "mask":{"type":"string"},
                            "region":{"type":"string"}
                        },
                        "additionalProperties":false,
                        "required":["mask","region"]
                    }
                },
                "mutually_exclusive_phenotypes":{
                    "type":"array",
                    "description":"For a list of defined mutually exclusive phenotyping strategies, specify what the label is for each.",
                    "items":{
                        "type":"object",
                        "properties":{
                            "strategy":{"type":"string"},
                            "label":{"type":"string"}
                        },
                        "required":["strategy","label"],
                        "additionalProperties":false
                    }
                },
                "binary_phenotypes":{
                    "type":"array",
                    "description":"This element describes all of the binary phenotype properties for this cell.",
                    "items":{
                        "type":"object",
                        "properties":{
                            "name":{
                                "type":"string",
                                "description":"The binary_phenotype_name"
                            },
                            "status":{
                                "type":"string",
                                "description":"The filter status of this Cell's binary phenotype.",
                                "enum":["+","-"]
                            }
                        },
                        "required":["name","status"],
                        "additionalProperties":false
                    }
                },
                "channel_measurements":{
                    "type":"array",
                    "items":{
                        "type":"object",
                        "marker_name":{"type":"string"},
                        "marker_measurements":{
                            "type":"array",
                            "items":{
                                "type":"object",
                                "properties":{
                                    "statistic":{"type":"string"},
                                    "compartment":{"type":"string"},
                                    "value":{"type":"float"}
                                },
                                "required":["statistic","value"],
                                "additionalProperties":false
                            }
                        }
                    }
                },
                "cell_contacts":{
                    "type":"array",
                    "items":{"type":"integer"},
                    "description":"If calculated/included, this is an array of Indicies of other cells in direct contact with this cell."
                }
            },
            "required":["index",
                        "cartesian_coordiantes",
                        "mutually_exclusive_region_label",
                        "mutually_exclusive_phenotype_label",
                        "binary_phenotypes"],
            "additionalProperties":false
        }
    },
    "properties":{
        "harmonized_cellular_image_attributes":{
            "type":"object",
            "properties":{
                "image_label":{"type":"string"},
                "image_size":{"$ref":"#/definitions/cartesian_coordinates"},
                "image_id":{
                    "type":"string",
                    "description":"A UUID4 identifier to uniquely label a data object containing a harmonized cellular image"
                }
            },
            "additionalProperties":false,
            "required":["image_label","image_size","image_id"]
        },
        "processed_image_mask":{"$ref":"#/definitions/binary_mask_image"},
        "segmentation_masks":{
            "type":"array",
            "items":{"$ref":"#/definitions/indexed_segmentation_image"}
        },
        "mutually_exclusive_region_masks":{
            "type":"array",
            "items":{"$ref":"#/definitions/indexed_mask_image"}
        },
        "cell_data":{
            "type":"array",
            "items":{"$ref":"#/definitions/cell_attributes"}
        },
        "mutually_exclusive_phenotype_strategies":{
            "type":"array",
            "description":"List the possible phenotypes for each phenotyping strategy.",
            "items":{
                "type":"object",
                "properties":{
                    "strategy":{"type":"string"},
                    "mutually_exclusive_phenotypes":{
                        "type":"array",
                        "items":{"type":"string"}
                    }
                },
                "required":["strategy","mutually_exclusive_phenotypes"],
                "additionalProperties":false
            }
        }
    },
    "additionalProperties":false,
    "required":["harmonized_cellular_image_attributes",
                "processed_image_mask",
                "segmentation_masks",
                "mutually_exclusive_region_masks",
                "mutually_exclusive_phenotype_strategies",
                "cell_data"]
}
