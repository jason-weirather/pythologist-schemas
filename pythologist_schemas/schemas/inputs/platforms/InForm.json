{
    "$schema": "https://json-schema.org/schema#",
    "type": "object",
    "description":"Describe expected components of an InForm project exports. This is a list of exports from the same project for the purpose of combining thresholding strategies.",
    "definitions":{
        "image_export":{
            "type":"object",
            "properties":{
                "image_name":{
                    "type":"string",
                    "description":"a base name"
                },
                "export_data":{
                    "type":"object",
                    "description":"These are the paths of the data elements created from InForm exports, although none are explicitly required here, what can be done downstream depends which of these are available.",
                    "properties":{
                        "component_data_tif_path":{
                            "type":"string",
                            "description":"A tif image with layers representative of channels measuring each stain."
                        },
                        "binary_segs_maps_tif_path":{
                            "type":"string",
                            "description":"A tif image with layers such as an optional processed image area mask, a nuclear and membrane mask index integer coded, and region mask."
                        },
                        "cell_seg_data_txt_path":{
                            "type":"string",
                            "description":"A file with the cell-phenotypes assigned per cell index, and mean intensity measures sufficient for infering any binary phenotypes."
                        },
                        "score_data_txt_path":{
                            "type":"string",
                            "description":"A file with one or two scores used in assigning binary phenotype thresholds."
                        }
                    },
                    "required":[]
                }
            }   
        },
        "sample_export":{
            "type":"object",
            "description":"A collection of imageExports that make up a sample.",
            "properties":{
                "sampleName":{"type":"string"},
                "image_exports":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/image_export"}
                }
            },
            "required":["sample_name","image_exports"]
        },
        "single_project_export":{
            "description":"A collection of exports, but may not contain all the threshold strategies.",
            "annotations":{
                "ref":"../annotations.json"
            },
            "properties":{
                "single_project_export_name":{"type":"string"},
                "is_primary_mutually_exclusive_phenotyping":{
                            "type":"boolean",
                            "description":"This project contains base phenotyping strategy.  At least one export must be true."
                },
                "scored_marker_names":{
                            "description":"These are the thresholds to take from these. These should be among the marker_name variables defined in the panel.",
                            "type":"array",
                            "items":{
                                "type":"string",
                                "name":"marker_name"
                            }
                },
                "rules":{
                    "type":"object",
                    "description":"If there are multiple InForm exports present, these rules define which features of this export to keep on merge",
                    "properties":{
                        "is_primary_mutually_exclusive_phenotyping":{
                            "type":"boolean",
                            "description":"if True, this project export is the basis for mutually exclusive phenotyping.  Other mutually exclusive phenotyping to captured from other exports should be converted to a binary phenotype in the rules defined here. At least one project must be primary."
                        },
                        "mutually_exclusive_phenotypes_to_merge_as_binary_phenotypes":{
                            "description":"This export has been phenotyped for something intended downstream to be treated as a thresholded marker.",
                            "type":"array",
                            "items":{
                                "type":"object",
                                "properties":{
                                    "mutually_exclusive_phenotype":{
                                        "description":"This needs to be a mutually exclusive phenotype defined by the annotations.",
                                        "type":"string"
                                    },
                                    "binary_phenotype_name":{
                                        "description":"This does NOT need to be a mutually exclusive phenotype defined by the panel.",
                                        "type":"string"
                                   }
                               }
                           }
                        },
                        "binary_phenotypes_to_merge":{
                            "description":"This is a list of binary phenotypes to keep from this project. If not set take merge all binary phenotypes.",
                            "type":"array",
                            "items":{
                                "type":"string",
                                "description":"Valid name of a binary phenotype."
                            }
                        },
                    },
                    "required":["is_primary_mutually_exclusive_phenotyping"]
                },
                "sampleExports":{
                    "type":"array",
                    "items":{"$ref":"#/definitions/sample_exports"}
                }
            },
            "required":["single_project_export_name","is_primary_mutually_exclusive_phenotyping","scored_marker_names","sample_exports"]
        }
    },
    "properties":{
        "microns_per_pixel":{"type":"float"},
        "project_name":{"type":"string"},
        "description":"A list of single project exports that can be combined.",
        "single_project_exports":{
            "type":"array",
            "description":"A list of one or more exports of the same project.",
            "items":{"$ref":"#/definitions/single_project_export"}
        }
    },
    "required":["microns_per_pixel","single_project_exports"]
}
